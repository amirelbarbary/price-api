<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أمير الخطير - آلة حاسبة ذكية</title>
    <!-- تحميل مكتبات React و ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- تحميل مكتبة Babel للتحويل من JSX إلى JavaScript -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- تحميل Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
            color: #333;
            font-size: 14px;
        }
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            text-align: center;
            border-bottom: 3px solid #5a67d8;
        }
        h1 {
            font-size: 32px;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .subtitle {
            font-size: 16px;
            opacity: 0.9;
        }
        .main-menu {
            padding: 40px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        .menu-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #dee2e6;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .menu-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            border-color: #667eea;
        }
        .menu-item h2 {
            font-size: 22px;
            color: #495057;
            margin-bottom: 15px;
        }
        .menu-item p {
            color: #6c757d;
            font-size: 16px;
        }
        .calculator {
            display: none;
            padding: 20px;
        }
        .project-title {
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }
        .project-title input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        button {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 12px;
        }
        .import-btn { background: #17a2b8; color: white; }
        .export-btn { background: #28a745; color: white; }
        .print-btn { background: #6f42c1; color: white; }
        .reset-btn { background: #dc3545; color: white; }
        button:hover { transform: translateY(-2px); }
        .controls {
            padding: 15px;
            display: flex;
            justify-content: space-between;
            background: #f1f3f5;
            font-size: 13px;
        }
        .tax-toggle {
            display: flex;
            align-items: center;
            font-weight: bold;
            color: #495057;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 45px;
            height: 22px;
            margin: 0 8px;
        }
        .switch input { opacity: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .3s;
            border-radius: 22px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background: white;
            transition: .3s;
            border-radius: 50%;
        }
        input:checked + .slider { background: #667eea; }
        input:checked + .slider:before { transform: translateX(23px); }
        .add-btn {
            background: #28a745;
            color: white;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 6px;
            text-align: center;
        }
        th {
            background: #667eea;
            color: white;
            font-weight: bold;
        }
        tr:nth-child(even) { background: #f8f9fa; }
        tr:hover { background: #e3f2fd; }
        input, select {
            width: 100%;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 12px;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 4px 6px;
            border-radius: 4px;
            font-size: 11px;
        }
        .totals-display {
            margin: 20px 0;
            padding: 15px;
            background: #fff3cd;
            border-radius: 8px;
            font-size: 13px;
        }
        .totals-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 10px;
        }
        .total-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            background: #e9ecef;
            border-radius: 6px;
        }
        .total-label {
            font-weight: bold;
            color: #495057;
            min-width: 180px;
        }
        .total-value {
            text-align: right;
            direction: ltr;
            font-weight: bold;
            color: #28a745;
        }
        .suggestions {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            width: 350px;
            display: none;
        }
        .suggestion-item {
            padding: 10px 12px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .suggestion-item:hover {
            background: #e9ecef;
        }
        .suggestion-item:last-child {
            border-bottom: none;
        }
        .suggestion-name {
            font-weight: bold;
            color: #333;
        }
        .suggestion-price {
            color: #28a745;
            font-weight: bold;
        }
        .suggestion-range {
            color: #6c757d;
            font-size: 11px;
        }
        .suggestion-source {
            color: #007bff;
            font-size: 10px;
        }
        .ai-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // تهيئة Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDc9X5v7Y7Z3X8X9X0X1X2X3X4X5X6X7X8",
            authDomain: "price-suggestions-db.firebaseapp.com",
            projectId: "price-suggestions-db",
            storageBucket: "price-suggestions-db.appspot.com",
            messagingSenderId: "1234567890",
            appId: "1:1234567890:web:abcdef1234567890"
        };
        
        // تهيئة Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // دالة لتحويل الأرقام إلى كلمات عربية
        function numberToArabicWords(number) {
            if (number === 0) return 'صفر';
            const ones = ['', 'واحد', 'اثنان', 'ثلاثة', 'أربعة', 'خمسة', 'ستة', 'سبعة', 'ثمانية', 'تسعة',
                         'عشرة', 'أحد عشر', 'اثنا عشر', 'ثلاثة عشر', 'أربعة عشر', 'خمسة عشر', 
                         'ستة عشر', 'سبعة عشر', 'ثمانية عشر', 'تسعة عشر'];
            const tens = ['', '', 'عشرون', 'ثلاثون', 'أربعون', 'خمسون', 'ستون', 'سبعون', 'ثمانون', 'تسعون'];
            const hundreds = ['', 'مائة', 'مئتان', 'ثلاثمائة', 'أربعمائة', 'خمسمائة', 'ستمائة', 'سبعمائة', 'ثمانمائة', 'تسعمائة'];
            const units = ['', 'ألف', 'مليون', 'مليار'];
            
            function convertThreeDigits(num) {
                let result = '';
                const hundred = Math.floor(num / 100);
                const remainder = num % 100;
                
                if (hundred > 0) {
                    result += hundreds[hundred];
                    if (remainder > 0) result += ' و ';
                }
                
                if (remainder > 0) {
                    if (remainder < 20) {
                        result += ones[remainder];
                    } else {
                        const ten = Math.floor(remainder / 10);
                        const one = remainder % 10;
                        if (one > 0) result += ones[one] + ' و ';
                        result += tens[ten];
                    }
                }
                return result;
            }
            
            let result = '';
            let unitIndex = 0;
            let tempNumber = Math.floor(number);
            
            while (tempNumber > 0) {
                const threeDigits = tempNumber % 1000;
                if (threeDigits > 0) {
                    let part = convertThreeDigits(threeDigits);
                    if (unitIndex > 0) {
                        part += ' ' + units[unitIndex];
                        if (threeDigits === 1 && unitIndex === 1) part = units[unitIndex];
                    }
                    result = result ? part + ' و ' + result : part;
                }
                tempNumber = Math.floor(tempNumber / 1000);
                unitIndex++;
            }
            
            return result;
        }

        function formatArabicCurrency(amount) {
            const wholePart = Math.floor(amount);
            const decimalPart = Math.round((amount - wholePart) * 100);
            let result = '';
            
            if (wholePart > 0) {
                result += numberToArabicWords(wholePart) + ' ريال سعودي';
            } else {
                result = 'صفر ريال سعودي';
            }
            
            if (decimalPart > 0) {
                result += ' و ' + numberToArabicWords(decimalPart) + ' هللة';
            }
            
            return result;
        }

        // المكون الرئيسي
        function App() {
            const [currentCalculator, setCurrentCalculator] = React.useState(null);
            const [projectName, setProjectName] = React.useState('');
            const [taxRate, setTaxRate] = React.useState(0.15);
            const [taxMode, setTaxMode] = React.useState(false);
            const [rows, setRows] = React.useState([]);
            const [suggestions, setSuggestions] = React.useState([]);
            const [showSuggestions, setShowSuggestions] = React.useState(false);
            const [suggestionsPosition, setSuggestionsPosition] = React.useState({ top: 0, right: 0 });
            
            // إضافة صف جديد
            const addRow = () => {
                const newRow = {
                    id: Date.now(),
                    item: '',
                    unit: '',
                    quantity: 0,
                    year1: 0,
                    year2: 0,
                    year3: 0,
                    price: 0,
                    tax: false
                };
                setRows([...rows, newRow]);
            };
            
            // حذف صف
            const deleteRow = (id) => {
                if (rows.length > 1) {
                    setRows(rows.filter(row => row.id !== id));
                }
            };
            
            // تحديث بيانات الصف
            const updateRow = (id, field, value) => {
                setRows(rows.map(row => {
                    if (row.id === id) {
                        const updatedRow = { ...row, [field]: value };
                        
                        // إذا تم تغيير الكمية، نوزعها على السنوات
                        if (field === 'quantity') {
                            const qty = parseFloat(value) || 0;
                            const yearsCount = currentCalculator || 3;
                            const share = (qty / yearsCount).toFixed(2);
                            updatedRow.year1 = share;
                            updatedRow.year2 = share;
                            updatedRow.year3 = share;
                        }
                        
                        return updatedRow;
                    }
                    return row;
                }));
            };
            
            // حساب السعر الإجمالي للصف
            const calculateRowTotal = (row) => {
                const price = parseFloat(row.price) || 0;
                const quantity = parseFloat(row.quantity) || 0;
                const isTaxExcluded = row.tax;
                
                let basePrice, taxAmount;
                
                if (isTaxExcluded) {
                    basePrice = price;
                    taxAmount = price * taxRate;
                } else {
                    basePrice = price / (1 + taxRate);
                    taxAmount = price - basePrice;
                }
                
                const totalPriceEx = quantity * basePrice;
                const totalTax = totalPriceEx * taxRate;
                const totalPriceInc = totalPriceEx + totalTax;
                
                return {
                    individualTax: taxAmount.toFixed(2),
                    totalEx: totalPriceEx.toFixed(2),
                    totalTax: totalPriceTax.toFixed(2),
                    totalInc: totalPriceInc.toFixed(2)
                };
            };
            
            // حساب الإجماليات
            const calculateTotals = () => {
                let totalQty = 0, totalEx = 0, totalTax = 0, totalInc = 0, totalIndTax = 0;
                
                rows.forEach(row => {
                    const totals = calculateRowTotal(row);
                    totalQty += parseFloat(row.quantity) || 0;
                    totalEx += parseFloat(totals.totalEx) || 0;
                    totalTax += parseFloat(totals.totalTax) || 0;
                    totalInc += parseFloat(totals.totalInc) || 0;
                    totalIndTax += parseFloat(totals.individualTax) || 0;
                });
                
                return {
                    totalQty,
                    totalEx,
                    totalTax,
                    totalInc,
                    totalIndTax
                };
            };
            
            // دالة للحصول على اقتراحات الأسعار من قاعدة بيانات Firebase
            const getPriceSuggestions = async (searchTerm, unit) => {
                try {
                    // في التطبيق الحقيقي، نبحث في قاعدة بيانات Firebase
                    const querySnapshot = await db.collection('prices')
                        .where('item', '>=', searchTerm)
                        .where('item', '<=', searchTerm + '\uf8ff')
                        .get();
                    
                    const results = [];
                    querySnapshot.forEach((doc) => {
                        results.push(doc.data());
                    });
                    
                    // إذا لم نجد نتائج، نستخدم قاعدة بيانات محلية
                    if (results.length === 0) {
                        const mockDatabase = {
                            "اسمنت": { "كيلو": 4.5, "طن": 4500 },
                            "حديد": { "كيلو": 18, "طن": 18000 },
                            "رمل": { "متر مكعب": 120, "طن": 12000 },
                            "بلاط": { "متر مربع": 35 },
                            "أنابيب": { "متر": 15 },
                            "أسلاك": { "متر": 8 },
                            "لمبة": { "وحدة": 18 },
                            "مكيف": { "وحدة": 1200 }
                        };
                        
                        Object.keys(mockDatabase).forEach(item => {
                            if (item.includes(searchTerm)) {
                                const itemData = mockDatabase[item];
                                Object.keys(itemData).forEach(itemUnit => {
                                    if (!unit || unit === itemUnit) {
                                        results.push({
                                            item: `${item} (${itemUnit})`,
                                            price: itemData[itemUnit],
                                            unit: itemUnit,
                                            source: "قاعدة بيانات محلية",
                                            updated: new Date().toISOString()
                                        });
                                    }
                                });
                            }
                        });
                    }
                    
                    return results;
                } catch (error) {
                    console.error("فشل في جلب السعر:", error);
                    return [];
                }
            };
            
            // عرض اقتراحات الأسعار
            const showPriceSuggestions = async (searchTerm, unit, inputElement) => {
                if (searchTerm.trim().length > 1) {
                    const results = await getPriceSuggestions(searchTerm, unit);
                    setSuggestions(results);
                    
                    // تحديد موقع مربع الإدخال
                    const rect = inputElement.getBoundingClientRect();
                    setSuggestionsPosition({
                        top: rect.bottom + window.scrollY,
                        right: window.innerWidth - rect.right
                    });
                    
                    setShowSuggestions(true);
                } else {
                    setShowSuggestions(false);
                }
            };
            
            // اختيار اقتراح
            const selectSuggestion = (suggestion, rowId) => {
                setRows(rows.map(row => {
                    if (row.id === rowId) {
                        return {
                            ...row,
                            item: suggestion.item,
                            unit: suggestion.unit,
                            price: suggestion.price
                        };
                    }
                    return row;
                }));
                setShowSuggestions(false);
            };
            
            // توزيع الكمية على السنوات
            const distributeQuantity = (rowId) => {
                const row = rows.find(r => r.id === rowId);
                if (!row) return;
                
                const qty = parseFloat(row.quantity) || 0;
                const yearsCount = currentCalculator || 3;
                const share = (qty / yearsCount).toFixed(2);
                
                updateRow(rowId, 'year1', share);
                updateRow(rowId, 'year2', share);
                updateRow(rowId, 'year3', share);
            };
            
            // عرض حاسبة معينة
            const showCalculator = (yearsCount) => {
                setCurrentCalculator(yearsCount);
                // إضافة صف فارغ إذا لم يكن هناك صفوف
                if (rows.length === 0) {
                    addRow();
                }
            };
            
            // مسح الكل
            const resetCalculator = () => {
                if (window.confirm("مسح الكل؟")) {
                    setRows([]);
                    setProjectName('');
                    addRow();
                }
            };
            
            // تصدير إلى Excel
            const exportToExcel = () => {
                // في التطبيق الحقيقي، نستخدم مكتبة xlsx
                alert("متوفر في الإصدار الكامل");
            };
            
            // حسابات الإجماليات
            const totals = calculateTotals();
            
            return (
                <div className="container">
                    <header>
                        <h1>أمير الخطير</h1>
                        <div className="subtitle">آلة حاسبة لجدول كميات المشاريع - متصلة بالذكاء الاصطناعي</div>
                    </header>
                    
                    {!currentCalculator ? (
                        <div className="main-menu">
                            <div className="menu-item" onClick={() => showCalculator(2)}>
                                <h2>جدول بسنتين</h2>
                                <p>إنشاء جدول كميات لمشروع مدته سنتين</p>
                            </div>
                            <div className="menu-item" onClick={() => showCalculator(3)}>
                                <h2>جدول بثلاث سنوات</h2>
                                <p>إنشاء جدول كميات لمشروع مدته ثلاث سنوات</p>
                            </div>
                            <div className="menu-item" onClick={() => showCalculator(4)}>
                                <h2>جدول بأربع سنوات</h2>
                                <p>إنشاء جدول كميات لمشروع مدته أربع سنوات</p>
                            </div>
                            <div className="menu-item" onClick={() => showCalculator(5)}>
                                <h2>جدول بخمس سنوات</h2>
                                <p>إنشاء جدول كميات لمشروع مدته خمس سنوات</p>
                            </div>
                        </div>
                    ) : (
                        <div className="calculator">
                            <div className="project-title">
                                <input 
                                    type="text" 
                                    value={projectName}
                                    onChange={(e) => setProjectName(e.target.value)}
                                    placeholder="اسم المشروع"
                                />
                                <div className="action-buttons">
                                    <button className="import-btn">📁 استيراد</button>
                                    <button className="export-btn" onClick={exportToExcel}>💾 تصدير</button>
                                    <button className="print-btn">🖨️ طباعة</button>
                                    <button className="reset-btn" onClick={resetCalculator}>🗑️ مسح</button>
                                </div>
                            </div>
                            
                            <div className="controls">
                                <div className="tax-toggle">
                                    <span>السعر شامل الضريبة</span>
                                    <label className="switch">
                                        <input 
                                            type="checkbox" 
                                            checked={taxMode}
                                            onChange={(e) => setTaxMode(e.target.checked)}
                                        />
                                        <span className="slider"></span>
                                    </label>
                                    <span>السعر غير شامل</span>
                                </div>
                                <button className="add-btn" onClick={addRow}>➕ إضافة بند</button>
                            </div>
                            
                            <div className="table-container">
                                <table className="calculator-table">
                                    <thead>
                                        <tr className="header-row">
                                            <th width="2%">م</th>
                                            <th width="18%">البند</th>
                                            <th width="7%">وحدة القياس</th>
                                            <th width="8%">الكمية الإجمالية</th>
                                            <th width="6%">السنة 1</th>
                                            <th width="6%">السنة 2</th>
                                            <th width="6%">السنة 3</th>
                                            <th width="8%">السعر الإفرادي</th>
                                            <th width="5%">ضريبة</th>
                                            <th width="9%">ضريبة السعر الفردي</th>
                                            <th width="10%">السعر الإجمالي (غير شامل)</th>
                                            <th width="10%">ضريبة الإجمالي</th>
                                            <th width="10%">الإجمالي (شامل)</th>
                                            <th width="2%">حذف</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {rows.map((row, index) => {
                                            const rowTotals = calculateRowTotal(row);
                                            return (
                                                <tr key={row.id}>
                                                    <td>{index + 1}</td>
                                                    <td>
                                                        <input 
                                                            type="text" 
                                                            value={row.item}
                                                            onChange={(e) => {
                                                                updateRow(row.id, 'item', e.target.value);
                                                                showPriceSuggestions(e.target.value, row.unit, e.target);
                                                            }}
                                                            placeholder="اسم البند"
                                                        />
                                                    </td>
                                                    <td>
                                                        <input 
                                                            type="text" 
                                                            value={row.unit}
                                                            onChange={(e) => {
                                                                updateRow(row.id, 'unit', e.target.value);
                                                                showPriceSuggestions(row.item, e.target.value, e.target);
                                                            }}
                                                            placeholder="اختر أو اكتب"
                                                        />
                                                    </td>
                                                    <td>
                                                        <input 
                                                            type="number" 
                                                            value={row.quantity}
                                                            onChange={(e) => {
                                                                updateRow(row.id, 'quantity', e.target.value);
                                                                distributeQuantity(row.id);
                                                            }}
                                                            min="0" 
                                                            step="0.01"
                                                        />
                                                    </td>
                                                    <td>
                                                        <input 
                                                            type="number" 
                                                            value={row.year1}
                                                            onChange={(e) => updateRow(row.id, 'year1', e.target.value)}
                                                            min="0" 
                                                            step="0.01"
                                                        />
                                                    </td>
                                                    <td>
                                                        <input 
                                                            type="number" 
                                                            value={row.year2}
                                                            onChange={(e) => updateRow(row.id, 'year2', e.target.value)}
                                                            min="0" 
                                                            step="0.01"
                                                        />
                                                    </td>
                                                    <td>
                                                        <input 
                                                            type="number" 
                                                            value={row.year3}
                                                            onChange={(e) => updateRow(row.id, 'year3', e.target.value)}
                                                            min="0" 
                                                            step="0.01"
                                                        />
                                                    </td>
                                                    <td>
                                                        <input 
                                                            type="number" 
                                                            value={row.price}
                                                            onChange={(e) => updateRow(row.id, 'price', e.target.value)}
                                                            min="0" 
                                                            step="0.01"
                                                        />
                                                    </td>
                                                    <td>
                                                        <label className="switch">
                                                            <input 
                                                                type="checkbox" 
                                                                checked={row.tax}
                                                                onChange={(e) => updateRow(row.id, 'tax', e.target.checked)}
                                                            />
                                                            <span className="slider"></span>
                                                        </label>
                                                    </td>
                                                    <td>{rowTotals.individualTax}</td>
                                                    <td>{rowTotals.totalEx}</td>
                                                    <td>{rowTotals.totalTax}</td>
                                                    <td>{rowTotals.totalInc}</td>
                                                    <td>
                                                        <button 
                                                            className="delete-btn" 
                                                            onClick={() => deleteRow(row.id)}
                                                        >
                                                            X
                                                        </button>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                            
                            <div className="totals-display">
                                <div>الإجماليات بالتفقيط:</div>
                                <div className="totals-grid">
                                    <div className="total-item">
                                        <div className="total-label">إجمالي الكميات:</div>
                                        <div className="total-value">
                                            {totals.totalQty.toFixed(2)} - {numberToArabicWords(totals.totalQty)}
                                        </div>
                                    </div>
                                    <div className="total-item">
                                        <div className="total-label">إجمالي ضريبة السعر الإفرادي:</div>
                                        <div className="total-value">
                                            {totals.totalIndTax.toFixed(2)} - {formatArabicCurrency(totals.totalIndTax)}
                                        </div>
                                    </div>
                                    <div className="total-item">
                                        <div className="total-label">إجمالي السعر غير شامل الضريبة:</div>
                                        <div className="total-value">
                                            {totals.totalEx.toFixed(2)} - {formatArabicCurrency(totals.totalEx)}
                                        </div>
                                    </div>
                                    <div className="total-item">
                                        <div className="total-label">إجمالي ضريبة السعر الإجمالي:</div>
                                        <div className="total-value">
                                            {totals.totalTax.toFixed(2)} - {formatArabicCurrency(totals.totalTax)}
                                        </div>
                                    </div>
                                    <div className="total-item">
                                        <div className="total-label">الإجمالي النهائي شامل الضريبة:</div>
                                        <div className="total-value">
                                            {totals.totalInc.toFixed(2)} - {formatArabicCurrency(totals.totalInc)}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* قائمة الاقتراحات */}
                    {showSuggestions && (
                        <div 
                            className="suggestions"
                            style={{
                                top: suggestionsPosition.top,
                                right: suggestionsPosition.right,
                                display: 'block'
                            }}
                        >
                            {suggestions.map((suggestion, index) => (
                                <div 
                                    key={index}
                                    className="suggestion-item"
                                    onClick={() => selectSuggestion(suggestion, rows[rows.length - 1]?.id)}
                                >
                                    <div>
                                        <div className="suggestion-name">
                                            <span className="ai-badge">AI</span> {suggestion.item}
                                        </div>
                                        <div className="suggestion-price">({suggestion.price} ر.س)</div>
                                        <div className="suggestion-source">[{suggestion.source}]</div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }
        
        // رندر المكون الرئيسي
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>