<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø© Ù„Ø¬Ø¯ÙˆÙ„ ÙƒÙ…ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø·ÙˆØ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
            color: #333;
            font-size: 14px;
        }
        .container {
            width: 100%;
            max-width: 1900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-bottom: 5px solid #5a67d8;
        }
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .subtitle {
            font-size: 16px;
            opacity: 0.9;
            font-weight: 300;
        }
        .project-title {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            border-bottom: 2px solid #e9ecef;
        }
        .project-title input {
            flex: 1;
            min-width: 350px;
            padding: 12px 15px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s;
            background: #fff;
        }
        .project-title input:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        button {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .import-btn {
            background: linear-gradient(135deg, #17a2b8, #20c997);
            color: white;
            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3);
        }
        .import-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(23, 162, 184, 0.4);
        }
        .export-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        .print-btn {
            background: linear-gradient(135deg, #6f42c1, #e83e8c);
            color: white;
            box-shadow: 0 4px 15px rgba(111, 66, 193, 0.3);
        }
        .print-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(111, 66, 193, 0.4);
        }
        .reset-btn {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
            color: white;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }
        .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }
        .settings-btn {
            background: linear-gradient(135deg, #fd7e14, #ffc107);
            color: white;
            box-shadow: 0 4px 15px rgba(253, 126, 20, 0.3);
        }
        .settings-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(253, 126, 20, 0.4);
        }
        .calculator {
            padding: 20px;
        }
        .settings-panel {
            background: linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            font-size: 14px;
            border: 2px solid #dee2e6;
        }
        .settings-panel.active {
            display: block;
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .settings-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .settings-group {
            flex: 1;
            min-width: 250px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .settings-group h3 {
            margin-bottom: 10px;
            color: #495057;
            font-size: 16px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .tax-toggle {
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            padding: 12px 18px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 14px;
            border: 2px solid #ffc107;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 25px;
            margin: 0 10px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 25px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 19px;
            width: 19px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        input:checked + .slider:before {
            transform: translateX(25px);
        }
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1400px;
            font-size: 13px;
            background: white;
        }
        th, td {
            border: 1px solid #dee2e6;
            padding: 10px 8px;
            text-align: center;
        }
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
            font-size: 13px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        tr:nth-child(even) {
            background: linear-gradient(135deg, #fff9e6 0%, #fff3cd 100%);
        }
        tr:hover {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            transform: scale(1.01);
            transition: all 0.2s;
        }
        input, select {
            width: 100%;
            padding: 8px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            text-align: center;
            font-size: 13px;
            transition: all 0.3s;
            background: #fff;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }
        .price-container {
            display: flex;
            gap: 4px;
        }
        .price-input {
            flex: 1;
        }
        .tax-toggle-cell {
            width: 40px;
        }
        .item-tax-toggle {
            width: 40px;
            height: 20px;
        }
        .delete-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 12px;
            font-weight: bold;
        }
        .delete-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }
        .total-row {
            font-weight: bold;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%) !important;
            font-size: 14px;
        }
        .final-summary {
            margin-top: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            font-size: 14px;
        }
        .final-summary-item {
            background: linear-gradient(135deg, #fff9e6 0%, #fff3cd 100%);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid #ffc107;
            transition: all 0.3s;
        }
        .final-summary-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .final-summary-title {
            font-size: 16px;
            font-weight: bold;
            color: #495057;
        }
        .final-summary-value {
            font-size: 16px;
            font-weight: bold;
            color: #28a745;
            text-align: left;
            min-width: 120px;
        }
        .final-summary-text {
            font-size: 13px;
            color: #6c757d;
            font-style: italic;
            text-align: left;
            min-width: 180px;
            margin-top: 5px;
        }
        .grand-total-item {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%) !important;
            border: 3px solid #28a745 !important;
            font-size: 18px;
        }
        .text-total-item {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #e2e3e5 0%, #f8f9fa 100%) !important;
            border: 2px solid #6c757d !important;
            text-align: center;
            flex-direction: column;
        }
        .add-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        .instructions {
            margin-top: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #fff4e6 0%, #ffe8cc 100%);
            border-left: 5px solid #fd7e14;
            border-radius: 8px;
            font-size: 14px;
        }
        .instructions h3 {
            margin-bottom: 10px;
            color: #e8590c;
            font-size: 16px;
        }
        .instructions ul {
            padding-right: 20px;
            line-height: 1.8;
        }
        .instructions li {
            margin-bottom: 8px;
        }
        @media (max-width: 768px) {
            .final-summary {
                grid-template-columns: 1fr;
            }
            .final-summary-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
                border-radius: 0;
            }
            .action-buttons, .controls, .delete-btn, .import-section, .settings-btn, .instructions {
                display: none !important;
            }
        }
        /* Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª */
        .suggestions {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            width: 350px;
            display: none;
        }
        .suggestion-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .suggestion-item:hover {
            background: #e9ecef;
        }
        .suggestion-item:last-child {
            border-bottom: none;
        }
        .suggestion-name {
            font-weight: bold;
            color: #333;
        }
        .suggestion-price {
            color: #28a745;
            font-weight: bold;
            min-width: 80px;
            text-align: right;
        }
        .suggestion-range {
            color: #6c757d;
            font-size: 11px;
        }
        .suggestion-source {
            color: #007bff;
            font-size: 11px;
            margin-top: 2px;
        }
        .ai-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø© Ù„Ø¬Ø¯ÙˆÙ„ ÙƒÙ…ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h1>
            <div class="subtitle">Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø·ÙˆØ± - Ù…Ø¹ Ø­Ø³Ø§Ø¨ Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥ÙØ±Ø§Ø¯ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</div>
        </header>
        <div class="project-title">
            <input type="text" id="project-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù‡Ù†Ø§">
            <div class="action-buttons">
                <button class="import-btn" id="import-btn">
                    <span>ğŸ“</span> Ø§Ø³ØªÙŠØ±Ø§Ø¯
                </button>
                <button class="export-btn" id="export-btn">
                    <span>ğŸ’¾</span> ØªØµØ¯ÙŠØ±
                </button>
                <button class="print-btn" id="print-btn">
                    <span>ğŸ–¨ï¸</span> Ø·Ø¨Ø§Ø¹Ø©
                </button>
                <button class="settings-btn" id="settings-btn">
                    <span>âš™ï¸</span> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                </button>
                <button class="reset-btn" id="reset">
                    <span>ğŸ—‘ï¸</span> Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                </button>
            </div>
        </div>
        <div class="calculator">
            <div class="settings-panel" id="settings-panel">
                <div class="settings-row">
                    <div class="settings-group">
                        <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ù†ÙˆØ§Øª</h3>
                        <div class="years-control">
                            <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ù†ÙˆØ§Øª:</label>
                            <input type="number" id="years-count" min="1" max="10" value="3">
                            <button id="apply-years">ØªØ·Ø¨ÙŠÙ‚</button>
                        </div>
                    </div>
                    <div class="settings-group">
                        <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</h3>
                        <div class="tax-settings">
                            <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</label>
                            <input type="number" id="tax-rate" min="0" max="100" value="15" step="0.1">
                            <span>%</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="controls">
                <div class="tax-toggle">
                    <span>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ Ø¨Ø¯ÙˆÙ†</span>
                    <label class="switch">
                        <input type="checkbox" id="global-tax-toggle">
                        <span class="slider"></span>
                    </label>
                    <span>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ Ù…ÙØ¹Ù„Ø©</span>
                </div>
                <button class="add-btn" id="add-row">
                    <span>â•</span> Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯ Ø¬Ø¯ÙŠØ¯
                </button>
            </div>
            <div class="table-container">
                <table id="calculator-table">
                    <thead>
                        <tr>
                            <th width="3%">Ù…</th>
                            <th width="18%">Ø§Ù„Ø¨Ù†Ø¯</th>
                            <th width="7%">ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³</th>
                            <th width="8%">Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</th>
                            <th width="6%">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</th>
                            <th width="6%">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</th>
                            <th width="6%">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©</th>
                            <th width="9%">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥ÙØ±Ø§Ø¯ÙŠ</th>
                            <th width="5%">Ø¶Ø±ÙŠØ¨Ø©</th>
                            <th width="9%">Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙØ±Ø¯ÙŠ</th>
                            <th width="10%">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØºÙŠØ± Ø´Ø§Ù…Ù„</th>
                            <th width="10%">Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                            <th width="10%">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</th>
                            <th width="3%">Ø­Ø°Ù</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td><input type="text" class="item-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ø¯"></td>
                            <td>
                                <select class="unit">
                                    <option value="Ø¹Ø¯Ø¯">Ø¹Ø¯Ø¯</option>
                                    <option value="Ø­Ø¨Ø©">Ø­Ø¨Ø©</option>
                                    <option value="ÙƒÙŠÙ„Ùˆ">ÙƒÙŠÙ„Ùˆ</option>
                                    <option value="Ù„ØªØ±">Ù„ØªØ±</option>
                                    <option value="Ù…ØªØ±">Ù…ØªØ±</option>
                                    <option value="Ø¹Ù„Ø¨Ø©">Ø¹Ù„Ø¨Ø©</option>
                                </select>
                            </td>
                            <td><input type="number" class="quantity" min="0" value="" step="0.01"></td>
                            <td><input type="number" class="year1" min="0" value="" step="0.01"></td>
                            <td><input type="number" class="year2" min="0" value="" step="0.01"></td>
                            <td><input type="number" class="year3" min="0" value="" step="0.01"></td>
                            <td>
                                <input type="number" class="price" min="0" value="0" step="0.01">
                            </td>
                            <td class="tax-toggle-cell">
                                <label class="switch">
                                    <input type="checkbox" class="item-tax-toggle">
                                    <span class="slider"></span>
                                </label>
                            </td>
                            <td class="individual-tax">0.00</td>
                            <td class="total-price-excluding">0.00</td>
                            <td class="total-tax">0.00</td>
                            <td class="total-price-including">0.00</td>
                            <td><button class="delete-btn">X</button></td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr class="total-row">
                            <td colspan="3">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</td>
                            <td id="total-quantity">0.00</td>
                            <td id="year1-total">0.00</td>
                            <td id="year2-total">0.00</td>
                            <td id="year3-total">0.00</td>
                            <td colspan="2">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
                            <td id="total-individual-tax">0.00</td>
                            <td id="total-price-excluding">0.00</td>
                            <td id="total-tax">0.00</td>
                            <td id="total-price-including">0.00</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <div class="final-summary">
                <div class="final-summary-item">
                    <div>
                        <div class="final-summary-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ…ÙŠØ§Øª:</div>
                        <div class="final-summary-text" id="final-text-quantity">ØµÙØ±</div>
                    </div>
                    <div class="final-summary-value" id="final-total-quantity">0.00</div>
                </div>
                <div class="final-summary-item">
                    <div>
                        <div class="final-summary-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙØ±Ø¯ÙŠ:</div>
                        <div class="final-summary-text" id="final-text-individual-tax">ØµÙØ± Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</div>
                    </div>
                    <div class="final-summary-value" id="final-total-individual-tax">0.00 Ø±ÙŠØ§Ù„</div>
                </div>
                <div class="final-summary-item">
                    <div>
                        <div class="final-summary-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¹Ø± ØºÙŠØ± Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</div>
                        <div class="final-summary-text" id="final-text-excluding">ØµÙØ± Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</div>
                    </div>
                    <div class="final-summary-value" id="final-total-excluding">0.00 Ø±ÙŠØ§Ù„</div>
                </div>
                <div class="final-summary-item">
                    <div>
                        <div class="final-summary-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</div>
                        <div class="final-summary-text" id="final-text-tax">ØµÙØ± Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</div>
                    </div>
                    <div class="final-summary-value" id="final-total-tax">0.00 Ø±ÙŠØ§Ù„</div>
                </div>
                <div class="final-summary-item grand-total-item">
                    <div>
                        <div class="final-summary-title">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</div>
                        <div class="final-summary-text" id="final-text-including">ØµÙØ± Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</div>
                    </div>
                    <div class="final-summary-value" id="final-total-including">0.00 Ø±ÙŠØ§Ù„</div>
                </div>
                <div class="final-summary-item text-total-item">
                    <div class="final-summary-title">Ø§Ù„ØªÙÙ‚ÙŠØ· Ù„Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</div>
                    <div class="final-summary-text" id="final-text-total" style="font-size: 16px; font-weight: bold; color: #495057;">ØµÙØ± Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</div>
                </div>
            </div>
            <div class="instructions">
                <h3>Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø·ÙˆØ±:</h3>
                <ul>
                    <li><strong>Ø­Ø³Ø§Ø¨ Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥ÙØ±Ø§Ø¯ÙŠ:</strong> ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥ÙØ±Ø§Ø¯ÙŠ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø­ÙˆØ§Ù„</li>
                    <li><strong>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØºÙŠØ± Ø´Ø§Ù…Ù„:</strong> ÙŠØ¸Ù‡Ø± Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</li>
                    <li><strong>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø´Ø§Ù…Ù„:</strong> ÙŠØ¸Ù‡Ø± Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</li>
                    <li><strong>ØªØµÙ…ÙŠÙ… Ù…Ø­Ø³Ù†:</strong> ÙˆØ§Ø¬Ù‡Ø© Ø£ÙƒØ«Ø± Ø¬Ù…Ø§Ù„Ø§Ù‹ Ù…Ø¹ ØªØ¯Ø±Ø¬Ø§Øª Ù„ÙˆÙ†ÙŠØ© ÙˆØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ©</li>
                    <li><strong>Ø­Ø³Ø§Ø¨Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©:</strong> Ù†Ø¸Ø§Ù… Ø­Ø³Ø§Ø¨ Ø£ÙƒØ«Ø± Ø¯Ù‚Ø© ÙˆØ´Ù…ÙˆÙ„ÙŠØ©</li>
                    <li><strong>ØªÙÙ‚ÙŠØ· Ø´Ø§Ù…Ù„:</strong> ØªØ­ÙˆÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø¥Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª Ø¹Ø±Ø¨ÙŠØ©</li>
                </ul>
            </div>
            <input type="file" id="file-input" style="display: none;" accept=".xlsx, .xls">
        </div>
    </div>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª -->
    <div id="suggestions" class="suggestions"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const table = document.getElementById('calculator-table');
            const tbody = table.querySelector('tbody');
            const addRowBtn = document.getElementById('add-row');
            const resetBtn = document.getElementById('reset');
            const exportBtn = document.getElementById('export-btn');
            const printBtn = document.getElementById('print-btn');
            const importBtn = document.getElementById('import-btn');
            const fileInput = document.getElementById('file-input');
            const settingsBtn = document.getElementById('settings-btn');
            const settingsPanel = document.getElementById('settings-panel');
            const yearsCountInput = document.getElementById('years-count');
            const applyYearsBtn = document.getElementById('apply-years');
            const globalTaxToggle = document.getElementById('global-tax-toggle');
            const taxRateInput = document.getElementById('tax-rate');
            let yearsCount = 3;
            let taxRate = 15;

            // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ---
            const suggestionsContainer = document.getElementById('suggestions');

            // âœ… Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ù…Ù† Cloudflare Worker
            async function getPriceSuggestions(searchTerm, unit) {
                try {
                    // âš ï¸ Ø§Ø³ØªØ¨Ø¯Ù„ <Ø§Ø³Ù…_Ù…Ø³ØªØ®Ø¯Ù…Ùƒ> Ø¨Ø§Ø³Ù…Ùƒ ÙÙŠ Cloudflare
                    const response = await fetch(`https://price-api.<Amirelbarbari@gmail.com>.workers.dev?item=${encodeURIComponent(searchTerm)}&unit=${encodeURIComponent(unit)}`);
                    const data = await response.json();
                    if (data.error) return [];
                    return Array.isArray(data) ? data : [data];
                } catch (error) {
                    console.error("ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø±:", error);
                    return [];
                }
            }

            // Ø¹Ø±Ø¶ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª
            function showSuggestions(suggestions, inputElement, nameInput, unitInput, priceInput) {
                suggestionsContainer.innerHTML = '';
                if (suggestions.length === 0) {
                    suggestionsContainer.style.display = 'none';
                    return;
                }

                const rect = inputElement.getBoundingClientRect();
                suggestionsContainer.style.top = (rect.bottom + window.scrollY) + 'px';
                suggestionsContainer.style.right = (window.innerWidth - rect.right) + 'px';

                suggestions.forEach(suggestion => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.innerHTML = `
                        <div>
                            <div class="suggestion-name"><span class="ai-badge">AI</span> ${suggestion.name}</div>
                            <div class="suggestion-range">Ø§Ù„Ù†Ø·Ø§Ù‚: ${suggestion.min} - ${suggestion.max} Ø±.Ø³</div>
                            <div class="suggestion-source">${suggestion.source}</div>
                        </div>
                        <div class="suggestion-price">${suggestion.price} Ø±.Ø³</div>
                    `;
                    div.addEventListener('click', () => {
                        const row = priceInput.closest('tr');
                        row.querySelector('.item-name').value = suggestion.name;
                        row.querySelector('.unit').value = suggestion.unit;
                        row.querySelector('.price').value = suggestion.price;
                        calculateRow(row);
                        calculateAll();
                        updateYearTotals();
                        suggestionsContainer.style.display = 'none';
                    });
                    suggestionsContainer.appendChild(div);
                });

                suggestionsContainer.style.display = 'block';
            }

            // Ø±Ø¨Ø· Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¨Ù…Ø¯Ø®Ù„ Ø§Ù„Ø¨Ù†Ø¯
            function setupSuggestions(row) {
                const nameInput = row.querySelector('.item-name');
                const unitInput = row.querySelector('.unit');
                const priceInput = row.querySelector('.price');

                nameInput.addEventListener('input', async function() {
                    if (this.value.trim().length > 1) {
                        const suggestions = await getPriceSuggestions(this.value, unitInput.value);
                        showSuggestions(suggestions, this, nameInput, unitInput, priceInput);
                    } else {
                        suggestionsContainer.style.display = 'none';
                    }
                });

                nameInput.addEventListener('blur', () => {
                    setTimeout(() => suggestionsContainer.style.display = 'none', 200);
                });
            }
            // --- Ù†Ù‡Ø§ÙŠØ© Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ---

            // Ø¯Ø§Ù„Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¥Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª Ø¹Ø±Ø¨ÙŠØ© Ù…Ø­Ø³Ù†Ø©
            function Tafgeet(amount) {
                if (amount === 0) return 'ØµÙØ± Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ';
                const parts = amount.toString().split('.');
                const wholePart = parseInt(parts[0]);
                const decimalPart = parts.length > 1 ? parseInt(parts[1].padEnd(2, '0').substring(0, 2)) : 0;
                const ones = ['', 'ÙˆØ§Ø­Ø¯', 'Ø§Ø«Ù†Ø§Ù†', 'Ø«Ù„Ø§Ø«Ø©', 'Ø£Ø±Ø¨Ø¹Ø©', 'Ø®Ù…Ø³Ø©', 'Ø³ØªØ©', 'Ø³Ø¨Ø¹Ø©', 'Ø«Ù…Ø§Ù†ÙŠØ©', 'ØªØ³Ø¹Ø©',
                             'Ø¹Ø´Ø±Ø©', 'Ø£Ø­Ø¯ Ø¹Ø´Ø±', 'Ø§Ø«Ù†Ø§ Ø¹Ø´Ø±', 'Ø«Ù„Ø§Ø«Ø© Ø¹Ø´Ø±', 'Ø£Ø±Ø¨Ø¹Ø© Ø¹Ø´Ø±', 'Ø®Ù…Ø³Ø© Ø¹Ø´Ø±', 
                             'Ø³ØªØ© Ø¹Ø´Ø±', 'Ø³Ø¨Ø¹Ø© Ø¹Ø´Ø±', 'Ø«Ù…Ø§Ù†ÙŠØ© Ø¹Ø´Ø±', 'ØªØ³Ø¹Ø© Ø¹Ø´Ø±'];
                const tens = ['', '', 'Ø¹Ø´Ø±ÙˆÙ†', 'Ø«Ù„Ø§Ø«ÙˆÙ†', 'Ø£Ø±Ø¨Ø¹ÙˆÙ†', 'Ø®Ù…Ø³ÙˆÙ†', 'Ø³ØªÙˆÙ†', 'Ø³Ø¨Ø¹ÙˆÙ†', 'Ø«Ù…Ø§Ù†ÙˆÙ†', 'ØªØ³Ø¹ÙˆÙ†'];
                const hundreds = ['', 'Ù…Ø§Ø¦Ø©', 'Ù…Ø¦ØªØ§Ù†', 'Ø«Ù„Ø§Ø«Ù…Ø§Ø¦Ø©', 'Ø£Ø±Ø¨Ø¹Ù…Ø§Ø¦Ø©', 'Ø®Ù…Ø³Ù…Ø§Ø¦Ø©', 'Ø³ØªÙ…Ø§Ø¦Ø©', 'Ø³Ø¨Ø¹Ù…Ø§Ø¦Ø©', 'Ø«Ù…Ø§Ù†Ù…Ø§Ø¦Ø©', 'ØªØ³Ø¹Ù…Ø§Ø¦Ø©'];
                const units = ['', 'Ø£Ù„Ù', 'Ù…Ù„ÙŠÙˆÙ†', 'Ù…Ù„ÙŠØ§Ø±'];
                function convertThreeDigits(num) {
                    let result = '';
                    const hundred = Math.floor(num / 100);
                    const remainder = num % 100;
                    if (hundred > 0) {
                        result += hundreds[hundred];
                        if (remainder > 0) result += ' Ùˆ ';
                    }
                    if (remainder > 0) {
                        if (remainder < 20) {
                            result += ones[remainder];
                        } else {
                            const ten = Math.floor(remainder / 10);
                            const one = remainder % 10;
                            if (one > 0) result += ones[one] + ' Ùˆ ';
                            result += tens[ten];
                        }
                    }
                    return result;
                }
                let result = '';
                let unitIndex = 0;
                let tempWhole = wholePart;
                while (tempWhole > 0) {
                    const threeDigits = tempWhole % 1000;
                    if (threeDigits > 0) {
                        let part = convertThreeDigits(threeDigits);
                        if (unitIndex > 0) part += ' ' + units[unitIndex];
                        result = result ? part + ' Ùˆ ' + result : part;
                    }
                    tempWhole = Math.floor(tempWhole / 1000);
                    unitIndex++;
                }
                result += ' Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ';
                if (decimalPart > 0) {
                    result += ' Ùˆ ' + convertThreeDigits(decimalPart) + ' Ù‡Ù„Ù„Ø©';
                }
                return result;
            }

            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            settingsBtn.addEventListener('click', function() {
                settingsPanel.classList.toggle('active');
            });

            // ØªØ·Ø¨ÙŠÙ‚ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ù†ÙˆØ§Øª
            applyYearsBtn.addEventListener('click', function() {
                yearsCount = parseInt(yearsCountInput.value) || 3;
                updateYearsColumns();
            });

            // ØªØ­Ø¯ÙŠØ« Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
            taxRateInput.addEventListener('input', function() {
                taxRate = parseFloat(this.value) || 15;
                calculateAll();
            });

            // Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯
            addRowBtn.addEventListener('click', function() {
                const newRow = document.createElement('tr');
                const rowCount = tbody.rows.length + 1;
                let yearInputs = '';
                for (let i = 1; i <= yearsCount; i++) {
                    yearInputs += `<td><input type="number" class="year${i}" min="0" value="" step="0.01"></td>`;
                }
                newRow.innerHTML = `
                    <td>${rowCount}</td>
                    <td><input type="text" class="item-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ø¯"></td>
                    <td>
                        <select class="unit">
                            <option value="Ø¹Ø¯Ø¯">Ø¹Ø¯Ø¯</option>
                            <option value="Ø­Ø¨Ø©">Ø­Ø¨Ø©</option>
                            <option value="ÙƒÙŠÙ„Ùˆ">ÙƒÙŠÙ„Ùˆ</option>
                            <option value="Ù„ØªØ±">Ù„ØªØ±</option>
                            <option value="Ù…ØªØ±">Ù…ØªØ±</option>
                            <option value="Ø¹Ù„Ø¨Ø©">Ø¹Ù„Ø¨Ø©</option>
                        </select>
                    </td>
                    <td><input type="number" class="quantity" min="0" value="" step="0.01"></td>
                    ${yearInputs}
                    <td><input type="number" class="price" min="0" value="0" step="0.01"></td>
                    <td class="tax-toggle-cell">
                        <label class="switch">
                            <input type="checkbox" class="item-tax-toggle" ${globalTaxToggle.checked ? 'checked' : ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td class="individual-tax">0.00</td>
                    <td class="total-price-excluding">0.00</td>
                    <td class="total-tax">0.00</td>
                    <td class="total-price-including">0.00</td>
                    <td><button class="delete-btn">X</button></td>
                `;
                tbody.appendChild(newRow);
                setupSuggestions(newRow);
                updateRowEvents();
                updateRowNumbers();
            });

            // ØªØ­Ø¯ÙŠØ« Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø³Ù†ÙˆØ§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            function updateYearsColumns() {
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø£Ø³
                const headerRow = table.querySelector('thead tr');
                // Ø¥Ø²Ø§Ù„Ø© Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                const existingYearHeaders = headerRow.querySelectorAll('th:nth-child(n+5):nth-child(-n+7)');
                existingYearHeaders.forEach(header => header.remove());
                // Ø¥Ø¶Ø§ÙØ© Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                const quantityHeader = headerRow.children[3];
                for (let i = 1; i <= yearsCount; i++) {
                    const yearHeader = document.createElement('th');
                    yearHeader.width = '6%';
                    yearHeader.textContent = `Ø§Ù„Ø³Ù†Ø© ${i === 1 ? 'Ø§Ù„Ø£ÙˆÙ„Ù‰' : i === 2 ? 'Ø§Ù„Ø«Ø§Ù†ÙŠØ©' : i === 3 ? 'Ø§Ù„Ø«Ø§Ù„Ø«Ø©' : i}`;
                    quantityHeader.after(yearHeader);
                }
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙÙˆÙ
                const rows = tbody.querySelectorAll('tr');
                rows.forEach(row => {
                    // Ø¥Ø²Ø§Ù„Ø© Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    const existingYearCells = row.querySelectorAll('td:nth-child(n+5):nth-child(-n+7)');
                    existingYearCells.forEach(cell => cell.remove());
                    // Ø¥Ø¶Ø§ÙØ© Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                    const quantityCell = row.children[3];
                    for (let i = 1; i <= yearsCount; i++) {
                        const yearCell = document.createElement('td');
                        const input = document.createElement('input');
                        input.type = 'number';
                        input.className = `year${i}`;
                        input.min = 0;
                        input.value = '';
                        input.step = 0.01;
                        yearCell.appendChild(input);
                        quantityCell.after(yearCell);
                    }
                });
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ°ÙŠÙŠÙ„
                const footerRow = table.querySelector('tfoot tr');
                const existingYearTotals = footerRow.querySelectorAll('td:nth-child(n+5):nth-child(-n+7)');
                existingYearTotals.forEach(cell => cell.remove());
                const totalQuantityCell = footerRow.children[3];
                for (let i = 1; i <= yearsCount; i++) {
                    const yearTotalCell = document.createElement('td');
                    yearTotalCell.id = `year${i}-total`;
                    yearTotalCell.textContent = '0.00';
                    totalQuantityCell.after(yearTotalCell);
                }
                updateRowEvents();
                calculateAll();
                updateYearTotals();
            }

            // ØªØ­Ø¯ÙŠØ« Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØµÙÙˆÙ
            function updateRowEvents() {
                const rows = tbody.querySelectorAll('tr');
                rows.forEach(row => {
                    const inputs = row.querySelectorAll('input');
                    inputs.forEach(input => {
                        input.addEventListener('input', function() {
                            if (this.classList.contains('quantity') || this.classList.contains('price')) {
                                distributeQuantityToYears(row);
                            }
                            if (this.className.startsWith('year')) {
                                updateQuantityFromYears(row);
                            }
                            calculateRow(row);
                            updateYearTotals();
                        });
                    });
                    const taxToggle = row.querySelector('.item-tax-toggle');
                    if (taxToggle) {
                        taxToggle.addEventListener('change', function() {
                            calculateRow(row);
                        });
                    }
                    const deleteBtn = row.querySelector('.delete-btn');
                    if (deleteBtn) {
                        deleteBtn.addEventListener('click', function() {
                            if (tbody.querySelectorAll('tr').length > 1) {
                                tbody.removeChild(row);
                                updateRowNumbers();
                                calculateAll();
                                updateYearTotals();
                            }
                        });
                    }
                });
            }

            // ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙƒÙ…ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø³Ù†ÙˆØ§Øª
            function distributeQuantityToYears(row) {
                const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
                const equalShare = quantity / yearsCount;
                for (let i = 1; i <= yearsCount; i++) {
                    const yearInput = row.querySelector(`.year${i}`);
                    if (yearInput && !yearInput.value) {
                        yearInput.value = equalShare.toFixed(2);
                    }
                }
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ© Ù…Ù† Ø§Ù„Ø³Ù†ÙˆØ§Øª
            function updateQuantityFromYears(row) {
                let total = 0;
                for (let i = 1; i <= yearsCount; i++) {
                    const yearInput = row.querySelector(`.year${i}`);
                    if (yearInput && yearInput.value) {
                        total += parseFloat(yearInput.value) || 0;
                    }
                }
                row.querySelector('.quantity').value = total.toFixed(2);
            }

            // Ø­Ø³Ø§Ø¨ ØµÙ ÙˆØ§Ø­Ø¯
            function calculateRow(row) {
                const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
                const price = parseFloat(row.querySelector('.price').value) || 0;
                const taxIncluded = row.querySelector('.item-tax-toggle').checked;
                // Ø­Ø³Ø§Ø¨ Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥ÙØ±Ø§Ø¯ÙŠ (ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø­ÙˆØ§Ù„)
                const individualTax = price * (taxRate / 100);
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØºÙŠØ± Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
                const totalPriceExcluding = quantity * price;
                // Ø­Ø³Ø§Ø¨ Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                const totalTax = totalPriceExcluding * (taxRate / 100);
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
                const totalPriceIncluding = totalPriceExcluding + totalTax;
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ù„Ø§ÙŠØ§
                row.querySelector('.individual-tax').textContent = individualTax.toFixed(2);
                row.querySelector('.total-price-excluding').textContent = totalPriceExcluding.toFixed(2);
                row.querySelector('.total-tax').textContent = totalTax.toFixed(2);
                row.querySelector('.total-price-including').textContent = totalPriceIncluding.toFixed(2);
                calculateAll();
            }

            // Ø­Ø³Ø§Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙŠÙ…
            function calculateAll() {
                let totalQuantity = 0;
                let totalIndividualTax = 0;
                let totalPriceExcluding = 0;
                let totalTax = 0;
                let totalPriceIncluding = 0;
                const rows = tbody.querySelectorAll('tr');
                rows.forEach(row => {
                    totalQuantity += parseFloat(row.querySelector('.quantity').value) || 0;
                    totalIndividualTax += parseFloat(row.querySelector('.individual-tax').textContent) || 0;
                    totalPriceExcluding += parseFloat(row.querySelector('.total-price-excluding').textContent) || 0;
                    totalTax += parseFloat(row.querySelector('.total-tax').textContent) || 0;
                    totalPriceIncluding += parseFloat(row.querySelector('.total-price-including').textContent) || 0;
                });
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ°ÙŠÙŠÙ„
                document.getElementById('total-quantity').textContent = totalQuantity.toFixed(2);
                document.getElementById('total-individual-tax').textContent = totalIndividualTax.toFixed(2);
                document.getElementById('total-price-excluding').textContent = totalPriceExcluding.toFixed(2);
                document.getElementById('total-tax').textContent = totalTax.toFixed(2);
                document.getElementById('total-price-including').textContent = totalPriceIncluding.toFixed(2);
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
                document.getElementById('final-total-quantity').textContent = totalQuantity.toFixed(2);
                document.getElementById('final-total-individual-tax').textContent = totalIndividualTax.toFixed(2) + ' Ø±ÙŠØ§Ù„';
                document.getElementById('final-total-excluding').textContent = totalPriceExcluding.toFixed(2) + ' Ø±ÙŠØ§Ù„';
                document.getElementById('final-total-tax').textContent = totalTax.toFixed(2) + ' Ø±ÙŠØ§Ù„';
                document.getElementById('final-total-including').textContent = totalPriceIncluding.toFixed(2) + ' Ø±ÙŠØ§Ù„';
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙÙ‚ÙŠØ·
                document.getElementById('final-text-quantity').textContent = Tafgeet(totalQuantity).replace(' Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ', '');
                document.getElementById('final-text-individual-tax').textContent = Tafgeet(totalIndividualTax);
                document.getElementById('final-text-excluding').textContent = Tafgeet(totalPriceExcluding);
                document.getElementById('final-text-tax').textContent = Tafgeet(totalTax);
                document.getElementById('final-text-including').textContent = Tafgeet(totalPriceIncluding);
                document.getElementById('final-text-total').textContent = Tafgeet(totalPriceIncluding);
            }

            // ØªØ­Ø¯ÙŠØ« Ù…Ø¬Ø§Ù…ÙŠØ¹ Ø§Ù„Ø³Ù†ÙˆØ§Øª
            function updateYearTotals() {
                for (let i = 1; i <= yearsCount; i++) {
                    let yearTotal = 0;
                    const rows = tbody.querySelectorAll('tr');
                    rows.forEach(row => {
                        const yearInput = row.querySelector(`.year${i}`);
                        if (yearInput) {
                            yearTotal += parseFloat(yearInput.value) || 0;
                        }
                    });
                    const yearTotalElement = document.getElementById(`year${i}-total`);
                    if (yearTotalElement) {
                        yearTotalElement.textContent = yearTotal.toFixed(2);
                    }
                }
            }

            // ØªØ­Ø¯ÙŠØ« Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØµÙÙˆÙ
            function updateRowNumbers() {
                const rows = tbody.querySelectorAll('tr');
                rows.forEach((row, index) => {
                    row.cells[0].textContent = index + 1;
                });
            }

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¬Ø¯ÙˆÙ„
            resetBtn.addEventListener('click', function() {
                if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù†ÙˆØ¯ØŸ")) {
                    tbody.innerHTML = '';
                    document.getElementById('project-name').value = '';
                    addRowBtn.click();
                    calculateAll();
                    updateYearTotals();
                }
            });

            // ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel
            exportBtn.addEventListener('click', function() {
                const projectName = document.getElementById('project-name').value || 'Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…';
                const data = [];
                data.push([projectName]);
                data.push([]);
                const headers = ['Ø­Ø°Ù', 'Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø´Ø§Ù…Ù„', 'Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ', 'Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØºÙŠØ± Ø´Ø§Ù…Ù„', 'Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙØ±Ø¯ÙŠ', 'Ø¶Ø±ÙŠØ¨Ø©', 'Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥ÙØ±Ø§Ø¯ÙŠ'];
                for (let i = yearsCount; i >= 1; i--) {
                    headers.push(`Ø§Ù„Ø³Ù†Ø© ${i}`);
                }
                headers.push('Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©', 'ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³', 'Ø§Ù„Ø¨Ù†Ø¯', 'Ù…');
                data.push(headers);
                const rows = tbody.querySelectorAll('tr');
                rows.forEach((row, index) => {
                    const rowData = [
                        '',
                        parseFloat(row.querySelector('.total-price-including').textContent) || 0,
                        parseFloat(row.querySelector('.total-tax').textContent) || 0,
                        parseFloat(row.querySelector('.total-price-excluding').textContent) || 0,
                        parseFloat(row.querySelector('.individual-tax').textContent) || 0,
                        row.querySelector('.item-tax-toggle').checked ? 'Ù†Ø¹Ù…' : 'Ù„Ø§',
                        parseFloat(row.querySelector('.price').value) || 0,
                    ];
                    for (let i = yearsCount; i >= 1; i--) {
                        const yearInput = row.querySelector(`.year${i}`);
                        rowData.push(parseFloat(yearInput?.value) || 0);
                    }
                    rowData.push(
                        parseFloat(row.querySelector('.quantity').value) || 0,
                        row.querySelector('.unit').value,
                        row.querySelector('.item-name').value,
                        index + 1
                    );
                    data.push(rowData);
                });
                const ws = XLSX.utils.aoa_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒÙ…ÙŠØ§Øª');
                XLSX.writeFile(wb, `${projectName}.xlsx`);
            });

            // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Excel
            importBtn.addEventListener('click', function() {
                fileInput.click();
            });

            // Ø·Ø¨Ø§Ø¹Ø©
            printBtn.addEventListener('click', function() {
                window.print();
            });

            // Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
            updateRowEvents();
            calculateAll();
            updateYearTotals();

            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­